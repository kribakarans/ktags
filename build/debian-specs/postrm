#!/bin/bash

set -u

KTAGSDIR=__ktags
HOME_DIR=/home/$SUDO_USER

validate_sudo_user() {
	if [ -z "$SUDO_USER" ]; then
		echo "Invalid SUDO_USER !!!"
		exit 1
	fi

	if [ ! -d $HOME_DIR ]; then
		echo "'$HOME_DIR' path not exist !!!"
		exit 1
	fi

	return $?
}

remove_ktags_aliases() {
	VIMRC=$HOME_DIR/.vimrc
	BASHRC=$HOME_DIR/.bashrc

	grep "tags=$KTAGSDIR" $VIMRC > /dev/null 2>&1
	if [ $? -eq 0 ]; then
		echo "Removing vim aliases ..."
		sed -i "/$KTAGSDIR/d" $VIMRC
	fi

	grep "$KTAGSDIR/cscope" $BASHRC > /dev/null 2>&1
	if [ $? -eq 0 ]; then
		echo "Removing bash aliases ..."
		sed -i "/$KTAGSDIR/d" $BASHRC
	fi

	return $?
}

#Main:
validate_sudo_user;
remove_ktags_aliases;

exit $?

#EOF
